/usr/bin/screen -dmS auth_warn_ssh sudo -u root /root/vdsetup.2/bin/utility/auth/ssh/auth_warn.sh 


sudo socat unix-listen:/tmp/mysocket.sock,fork -&
sudo -u root /root/vdsetup.2/bin/utility/auth/ssh/auth_warn.sh | sudo socat - unix-connect:/tmp/mysocket.sock



[Unit]
Description=Auth_Warn_SSH
After=network.target

[Service]
Type=forking
User=root
ExecStart=/usr/bin/screen -dmS auth_warn_ssh sudo -u root /root/vdsetup.2/bin/utility/auth/ssh/auth_warn.sh 
ExecStop=/usr/bin/screen -S auth_warn_ssh -X quit

[Install]
WantedBy=multi-user.target



sudo socat unix-listen:/tmp/mysocket.sock,fork -& 
sudo socat unix:/tmp/mysocket.sock -
ExecStart=/usr/bin/screen -dmS auth_warn_ssh socat unix-listen:/tmp/mysocket.sock,fork -&

Сохраните файл.

Запустите команду sudo systemctl daemon-reload, чтобы перезагрузить список юнитов в systemd.

Запустите команду sudo systemctl enable Auth_Warn_SSH.service, чтобы включить автозапуск данного юнита при старте системы.

Запустите команду sudo systemctl start Auth_Warn_SSH.service, чтобы запустить данную службу.

Теперь команда /usr/bin/screen -dmS auth_screen_warn /bin/bash /root/vdsetup.2/bin/utility/auth_screen_warn.sh будет запускаться автоматически при старте системы и будет остановлена при ее выключении.


Команда screen -dmS используется для создания новой сессии в screen и запуска ее в фоновом режиме (detach). Опции S и d определяют следующее:

d - опция detach означает, что сессия будет запущена в фоновом режиме. Это означает, что вы не будете сразу же переведены в эту сессию, а сможете продолжать работать в текущем окне терминала.

Опция -m в команде screen означает, что при запуске новой сессии не нужно ждать подтверждения от пользователя, а сразу создать новую сессию. Это удобно, если вы хотите автоматизировать процесс создания новых сессий и не хотите вручную подтверждать каждый раз.

S - опция позволяет задать имя сессии, которое будет использоваться для идентификации сессии в дальнейшем. Например, если указать -S mysession, то в дальнейшем можно будет управлять сессией с помощью команды screen -r mysession.

Таким образом, команда screen -dmS mysession создаст новую сессию с именем mysession и запустит ее в фоновом режиме.



Тире в конце команды sudo socat UNIX-LISTEN:/tmp/mysocket.sock - означает, что socat будет читать данные из стандартного ввода (stdin), вместо того, чтобы читать их из файла или сетевого сокета. Это позволяет передавать данные в socat из других команд или скриптов, используя конвейер (pipeline) или перенаправление потоков ввода-вывода.

В данном случае, команда sudo socat UNIX-LISTEN:/tmp/mysocket.sock - будет слушать соединения на UNIX-сокете /tmp/mysocket.sock и читать данные из стандартного ввода (stdin), чтобы передать их через этот сокет другим процессам, которые будут подключаться к этому сокету.